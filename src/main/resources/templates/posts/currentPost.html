<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head th:replace="fragments/layout :: site-head">
    <meta charset="UTF-8"/>
    <title th:text="${post.title}">Tile of the Post</title>
</head>
<body>

    <header th:replace="fragments/layout :: site-header"></header>

    <main class="main-bottom">

        <div class="container">
            <div class="white">
                <div class="row">
                    <h1 class="text-center"><b th:text="${post.title}"></b></h1>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <img class="big" th:if="${post.icon}" th:src="@{/res/image-post/} + ${post.icon}"/>
                    </div>
                    <div class="col-md-6 multiline2" th:text="${post.description}"></div>
                </div>

                <div class="row">
                    <div class="floatLeft">
                        <h2 class="bold">Date posted : <span th:text="${post.date}"></span></h2>
                    </div>
                    <div class="floatRight">
                        <h2 class="bold">
                            Author : <a th:href="@{/user/} + ${post.author.id}" th:text="${post.author.fullname}"></a>
                        </h2>
                    </div>
                </div>
            </div>

            <div class="row"><h2 class="col-md-12 bold text-center">Comments:</h2></div>

            <div th:if="${user}" class="row">
                <div class="col-md-2">
                    <img class="image-padding" th:if="${user.profile_picture}" style="height: 100px;"
                         th:src="@{/res/images/} + ${#authentication.getName()} + @{/} + ${user.profile_picture}"/>
                    <img th:unless="${user.profile_picture}" style="width: 100%" src="/res/images/default-user.png"/>
                </div>
                <form method="post">
                    <textarea class="col-md-6 margintop30" placeholder="Comment" name="comment"></textarea>
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <div class="col-md-1">
                    <button class="btn btn-primary margintop30" type="submit">Comment</button>
                    </div>
                </form>
            </div>

            <div th:if="${post.comments}" th:each="com : ${post.comments}">

                <div class="row borderPadding2">

                    <div class="col-md-2">
                        <img class="image-padding" th:if="${com.author.profile_picture}" style="height: 100px;"
                             th:src="@{/res/images/} + ${com.author.username} + @{/} + ${com.author.profile_picture}"/>
                        <img th:unless="${com.author.profile_picture}" style="width: 100%" src="/res/images/default-user.png"/>
                    </div>
                    <div class="col-md-6 margintop30 borderPadding2" placeholder="Comment" th:text="${com.comment}"></div>
                    <div th:if="${user}" class="col-md-4">
                        <button class="reply btn btn-info margintop30">Reply</button>
                    </div>
                </div>

                <div th:if="${com.replies}">
                    <div class="row" th:each="reply : ${com.replies}">
                        <div class="col-md-2">
                            <img class="image-padding" th:if="${reply.author.profile_picture}" style="height: 100px;"
                                 th:src="@{/res/images/} + ${reply.author.username} + @{/} + ${reply.author.profile_picture}"/>
                            <img th:unless="${reply.author.profile_picture}" style="width: 100%" src="/res/images/default-user.png"/>
                        </div>
                        <div class="col-md-6 margintop30 multiline2 borderPadding2" placeholder="Comment" th:text="${reply.reply}"></div>
                    </div>
                </div>

                <div th:if="${user}" class="row">
                    <div class="reply-comment">

                        <div class="col-md-2">
                            <img class="image-padding" th:if="${user.profile_picture}" style="height: 100px;"
                                 th:src="@{/res/images/} + ${#authentication.getName()} + @{/} + ${user.profile_picture}"/>
                            <img th:unless="${user.profile_picture}" style="width: 100%" src="/res/images/default-user.png"/>
                        </div>
                        <form method="post">
                            <textarea class="col-md-6 margintop30" placeholder="Reply" name="reply"></textarea>
                            <input type="hidden" th:value="${com.id}" name="commentForReply"/>
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <div class="col-md-1">
                                <button class="btn btn-primary margintop30" type="submit">Comment</button>
                            </div>
                        </form>

                    </div>
                </div>
            </div>

        </div>


    </main>

    <footer th:replace="fragments/layout :: site-footer"></footer>

</body>
</html>